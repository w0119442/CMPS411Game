<div id="themeDiv">
	<button id="tankTheme">Tank</button>
</div>

<canvas id="ctx" width="500" height="500" style="border:1px solid #000000;"></canvas>
<canvas id="worldMap" width="5000" height="5000" style="display:none;"></canvas>

<script src="https://cdn.socket.io/socket.io-1.4.8.js"></script>

<script>
	var WORLD_WIDTH = 1000;
	var WORLD_HEIGHT = 1000;
	var MAP_WRAP_NUMBER = 1;
	var VIEW_WIDTH = 500;
	var VIEW_HEIGHT = 500;
	var PLAYER_SIZE = 50;
	
	var PLAYER_LIST = {};
	var socket = io();

	// theme selections
	var themeDiv = document.getElementById('themeDiv');
	var tankTheme = document.getElementById('tankTheme');
	
	var Img = {};
	Img.player = new Image();
	Img.projectile = new Image();
	Img.map = new Image();
	Img.bground = new Image();
	Img.player.src = '/client/img/Tank/player.png';
	Img.projectile.src = '/client/img/Tank/bullet.png';
	Img.map.src = '/client/img/Tank/map.png';
	Img.bground.src = '/client/img/Tank/bground.png';
	
	<!--
	/*
	tankTheme.onclick = function() {
		Img.player.src = '/client/img/tank/player.png';
		Img.projectile.src = '/client/img/tank/bullet.png';
		Img.map.src = '/client/img/tank/map.png';
	}
	*/
	-->
	
	var worldMapCanvas = document.getElementById("worldMap");
	var worldMap = worldMapCanvas.getContext("2d");
	Img.map.onload = function() {
		var patrn = worldMap.createPattern(Img.map, "repeat");
		worldMap.fillStyle = patrn;
		worldMap.fillRect(0, 0, worldMapCanvas.width, worldMapCanvas.height);
	}
	
	// game area
	var ctx = document.getElementById("ctx").getContext("2d");
	ctx.font = '30px Arial';
	
	var clientId = null;
	
	socket.on('init',function(data) {
		if(data.selfId) {
			clientId = data.selfId;
		}
	});
	
	socket.on('newPositions',function(data) {
		ctx.clearRect(0, 0, VIEW_WIDTH, VIEW_HEIGHT);
		ctx.drawImage(Img.bground, 0, 0, VIEW_WIDTH, VIEW_HEIGHT);
		
		var playerX = 0.0;
		var playerY = 0.0;
		var pCenterX = 0.0;
		var pCenterY = 0.0;
	
		for(var i = 0; i < data.player.length; i++) {
			if(data.player[i].id == clientId) {
				playerX = data.player[i].x;
				playerY = data.player[i].y;
				pCenterX = playerX + PLAYER_SIZE/2;
				pCenterY = playerY + PLAYER_SIZE/2;
				clipX = pCenterX - VIEW_WIDTH/2;
				clipY = pCenterY - VIEW_HEIGHT/2;
				//drawImage(image, clipX, clipY, clipWidth, clipHeight, xPos, yPos, imageWidth, imageHeight)
				ctx.drawImage(worldMapCanvas, clipX, clipY, VIEW_WIDTH, VIEW_HEIGHT, 0, 0, VIEW_WIDTH, VIEW_HEIGHT);
			}
		}
		
		for(var i = 0; i < data.projectile.length; i++) {
			var projX = data.projectile[i].x - pCenterX + VIEW_WIDTH/2;
			var projY = data.projectile[i].y - pCenterY + VIEW_HEIGHT/2;
			ctx.drawImage(Img.projectile, projX, projY, 10, 10);
		}

		for(var i = 0; i < data.player.length; i++) {
			if(data.player[i].id == clientId) {
				ctx.save();
//				ctx.drawImage(Img.player, (VIEW_WIDTH - PLAYER_SIZE)/2, (VIEW_HEIGHT - PLAYER_SIZE)/2, PLAYER_SIZE, PLAYER_SIZE);
				ctx.translate(VIEW_WIDTH/2, VIEW_HEIGHT/2);
				ctx.rotate(data.player[i].turnAngle * Math.PI/180);
				ctx.drawImage(Img.player, -PLAYER_SIZE/2, -PLAYER_SIZE/2, PLAYER_SIZE, PLAYER_SIZE);
				ctx.restore();
			}
			else if(Math.abs(pCenterX - data.player[i].x) < VIEW_WIDTH && Math.abs(pCenterY - data.player[i].y) < VIEW_HEIGHT) {
				var otherX = data.player[i].x - pCenterX + VIEW_WIDTH/2;
				var otherY = data.player[i].y - pCenterY + VIEW_HEIGHT/2;
				ctx.drawImage(Img.player, otherX, otherY, PLAYER_SIZE, PLAYER_SIZE);
			}
		}
	});
	
	document.onkeydown = function(event) {
		if(event.keyCode == 68 || event.keyCode == 39) {
			socket.emit('keyPress',{inputId:'right', state:true});
		}
		else if(event.keyCode == 65 || event.keyCode == 37) {
			socket.emit('keyPress',{inputId:'left', state:true});
		}
		
		else if(event.keyCode == 83 || event.keyCode == 40) {
			socket.emit('keyPress',{inputId:'down', state:true});
		}
		else if(event.keyCode == 87 || event.keyCode == 38) {
			socket.emit('keyPress',{inputId:'up', state:true});
		}
	}
	
	document.onkeyup = function(event) {
		if(event.keyCode == 68 || event.keyCode == 39) {
			socket.emit('keyPress',{inputId:'right', state:false});
		}
		else if(event.keyCode == 65 || event.keyCode == 37) {
			socket.emit('keyPress',{inputId:'left', state:false});
		}
		
		else if(event.keyCode == 83 || event.keyCode == 40) {
			socket.emit('keyPress',{inputId:'down', state:false});
		}
		else if(event.keyCode == 87 || event.keyCode == 38) {
			socket.emit('keyPress',{inputId:'up', state:false});
		}
	}
	
	document.onclick = function(event){
		socket.emit('keyPress',{inputId:'attack',state:true});
	}
	
	document.onmousemove = function(event){
		var x = (-VIEW_WIDTH/2 + PLAYER_SIZE/2) + event.clientX;
		var y = (-VIEW_HEIGHT/2 + PLAYER_SIZE/2) + event.clientY;
		var angle = Math.atan2(y,x) / Math.PI * 180;
		socket.emit('keyPress',{inputId:'mouseAngle',state:angle});
	}
	
</script>