<!DOCTYPE html>
<html>
<head>
</head>

<body>
	<canvas id="map"></canvas>
	<script src="https://cdn.socket.io/socket.io-1.4.8.js"></script>
</body>

<script src="/client/js/constants.js"></script>

<script>
	var socket = io();
	var fixRadius = 10;
	var maxNumPlay = 100;
	var borderSize = 10;
	var team = 0;
	
	window.addEventListener("resize", resizeWindow);
	var clientWidth = window.innerWidth - 2 * borderSize;
	var clientHeight = window.innerHeight - 2 * borderSize;
	var playFit = Math.min(Math.floor(clientWidth/maxNumPlay), Math.floor(clientHeight/maxNumPlay));
	var radius = Math.max(fixRadius, playFit);

	// Set up game area (viewport)
	var ctx = document.getElementById("map").getContext("2d");
	ctx.canvas.width = clientWidth;
	ctx.canvas.height = clientHeight;
	ctx.font = '30px Arial';
	
	socket.on('newPositions',function(data) {
		drawMap();
		
		if(clientId != null && clientId !=-1) {
			team = data.player[clientId].team;
		}
		
		for(var i in data.player) {	
			drawPlayers(data.player[i].x, data.player[i].y, data.player[i].team);
		}
	});
	
	function resizeWindow() {
		clientWidth = window.innerWidth - 2 * borderSize;
		clientHeight = window.innerHeight - 2 * borderSize;
		ctx.canvas.width = clientWidth;
		ctx.canvas.height = clientHeight;
		playFit = Math.min(Math.floor(clientWidth/maxNumPlay), Math.floor(clientHeight/maxNumPlay));
		radius = Math.max(fixRadius, playFit);	
		ctx.font = '30px Arial';
	}
	
	function drawMap() {
		ctx.clearRect(0, 0, clientWidth, clientHeight);	
		ctx.fillStyle = "#E5E4E2";
		ctx.fillRect(0, 0, clientWidth, clientHeight);
		ctx.beginPath();
		ctx.lineWidth = borderSize;
		ctx.strokeStyle = "#000000";
		ctx.rect(0, 0, clientWidth, clientHeight);
		ctx.stroke();
	}
	
	function drawPlayers(playerX, playerY, pTeam) {
		var xCoord = 0;
		var yCoord = 0;
		var hpColorN = "#990012";
		var hpColorY = "#6cc417";
		var color = "#FFFFFF";
		
		var scaleX = (clientWidth - 2 * borderSize)/(WORLD_WIDTH * MAP_WRAP_NUMBER);
		var scaleY = (clientHeight - 2 * borderSize)/(WORLD_HEIGHT * MAP_WRAP_NUMBER);
		
		xCoord = Math.floor(scaleX * (playerX + PLAYER_SIZE/2) + borderSize);
		yCoord = Math.floor(scaleY * (playerY + PLAYER_SIZE/2) + borderSize);
		
		if(team === pTeam) {
			color = hpColorY;
		}
		else {
			color = hpColorN;
		}
		
		ctx.beginPath();
		ctx.arc(xCoord, yCoord, radius, 0, 2*Math.PI);
		ctx.fillStyle = color;
		ctx.fill();
		ctx.strokeStyle = color;
		ctx.stroke();
	}
</script>
</html>